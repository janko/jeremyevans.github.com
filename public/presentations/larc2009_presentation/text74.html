<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
     "http://www.w3.org/TR/html4/transitional.dtd">
<html>
<head>
  <meta HTTP-EQUIV=CONTENT-TYPE CONTENT="text/html; charset=utf-8">
  <title>Slide 75</title>
</head>
<body>
<center>
<a href="text0.html">First page</a> <a href="text73.html">Back</a> <a href="text75.html">Continue</a> <a href="text84.html">Last page</a> <a href="sequel-larc2009-pres.html">Overview</a> <a href="img74.html">Graphics</a></center><br>
<h1 style="direction:ltr;"></h1>
<br>
<h3>Notes:</h3>
<p style="direction:ltr;">For each firm in the dataset we are eagerly loading, we first set the cached invoices association to the empty array.</p>
<p style="direction:ltr;"></p>
<p style="direction:ltr;">Then we get all invoices for all clients of all of the firms in the dataset, using the keys of the id map.</p>
<p style="direction:ltr;"></p>
<p style="direction:ltr;">For each of those invoices, we associate it back to the related firm using the values of the id map for the invoice's client's firm_id, adding it to the existing array of invoices</p>
<p style="direction:ltr;"></p>
<p style="direction:ltr;">After you are finished processing all of the invoices, each firm will have the all related invoices in the association cache, so calling the invoices method on any firm object returned will not cause any additional database queries.</p>
<p style="direction:ltr;"></p>
<p style="direction:ltr;">Note that there is nothing inherently specific about this approach, creating a generic plugin that supported any has_many through has many association is possible and probably not even all that complex.</p>
<p style="direction:ltr;"></p>
<p style="direction:ltr;">There is already a plugin that does something similar for polymorphic associations, using basically what I've already explained.</p>
</body>
</html>
<!DOCTYPE html>

<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Rodauth: Ruby's Most Advanced Authentication Framework</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/>

  <link rel="stylesheet" href="./css/reset.css" type="text/css"/>

  <link type="text/css" href="./css/fg.menu.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/theme/ui.all.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/sh_style.css" rel="stylesheet" />
  <link type="text/css" href="./css/tipsy.css" rel="stylesheet" />

  <link rel="stylesheet" href="./css/showoff.css" type="text/css"/>

    <style type="text/css">
      @media screen {
        #preso, .slide {
          width: 1280px;
          height: 720px;
        }
        #footer { width: 1261px; }
      }
    </style>

  <script type="text/javascript" src="./js/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="./js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src="./js/jquery-print.js"></script>
  <script type="text/javascript" src="./js/jquery.batchImageLoad.js"></script>
  <script type="text/javascript" src="./js/jquery.parsequery.min.js"></script>
  <script type="text/javascript" src="./js/jquery.doubletap-0.1.js"></script>
  <script type="text/javascript" src="./js/jquery.tipsy.js"></script>

  <script type="text/javascript" src="./js/fg.menu.js"></script>
  <script type="text/javascript" src="./js/showoff.js"></script>
  <script type="text/javascript" src="./js/jTypeWriter.js"> </script>
  <script type="text/javascript" src="./js/sh_main.min.js"></script>
  <script type="text/javascript" src="./js/core.js"></script>
  <script type="text/javascript" src="./js/showoffcore.js"></script>
  <script type="text/javascript" src="./js/coffee-script.js"></script>

      <script type="text/javascript" src="./js/sh_lang/sh_ruby.min.js"></script>

    <link rel="stylesheet" href="./file/fonts.css" type="text/css"/>
    <link rel="stylesheet" href="./file/something.css" type="text/css"/>


  <script type="text/javascript">
  $(function(){
      if(!('slaveWindow' in window) && window.name !== 'toolbar' && $(window).width() < $(document).width()) {
        no_resize = true;
        $('body').css("zoom", ""+($(window).width()*100.0)/$(document).width()+"%");
        $('body').css("overflow-y", "auto");
        $('body').css("overflow-x", "hidden");
        $('#notesInfo').css("font-size", ""+$(document).width()*14.0/$(window).width()+"px");
        $('#notesInfo').css("line-height", ""+$(document).width()*20.0/$(window).width()+"px");
      }
      setupPreso(false, '.');
  });
  </script>

</head>

<body>

<div id="help">
  <table>
    <tr><td class="key">z, ?</td><td>toggle help (this)</td></tr>
    <tr><td class="key">space, &rarr;</td><td>next slide</td></tr>
    <tr><td class="key">shift-space, &larr;</td><td>previous slide</td></tr>
    <tr><td class="key">d</td><td>toggle debug mode</td></tr>
    <tr><td class="key">## &lt;ret&gt;</td><td>go to slide #</td></tr>
    <tr><td class="key">r</td><td>reload slides</td></tr>
    <tr><td class="key">n</td><td>toggle notes</td></tr>
  </table>
</div>

<div class="buttonNav">
  <input type="submit" onClick="prevStep();" value="prev"/>
  <input type="submit" onClick="nextStep();" value="next"/>
</div>

<div id="preso"><center>loading presentation...</center></div>
<div id="footer">
  <span id="notesInfo"></span>
  <img id="disconnected" src="/css/disconnected.png" />
</div>

<div id="slides" class="offscreen" style="display:none;">
<div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/1">

<div class="notes">
<p>Good afternoon everyone. Today I&#x2019;ll be talking about Rodauth, Ruby&#x2019;s most advanced authentication framework.</p>
</div>
<h1 class="blue" style="font-size: 200px; position: absolute; top: 40px; left: 16px;">Rodauth</h1><h1 class="red" style="font-size: 80px; position: absolute; top: 220px; left: 40px;">Ruby's Most Advanced Authentication Framework</h1><h1 class="red" style="font-size: 72px; position: absolute; top: 508px; right: 60px; text-align: right;">Pivorak Conf 5.0</h1><h1 class="blue" style="font-size: 72px; position: absolute; top: 580px; right: 60px; text-align: right;">May 2020</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/2">

<div class="notes">
<p>My name is Jeremy Evans. I&#x2019;m the author of Rodauth. I&#x2019;m also a Ruby committer, an OpenBSD committer, and the maintainer of the Sequel database library and the Roda web toolkit, as well as many other gems. When I&#x2019;m not busy working on open source projects, I manage the IT operations for a small government department, including leading the programming team. I say team, but it&#x2019;s really just me and one other programmer.</p>
</div>

<p><img class="profile-pic" src="./file/jeremy.jpg" style="position: absolute; top: 128px; left: 64px;"/>
<h1 class="red" style="font-size: 48px; position: absolute; top: 288px; left: 500px;">GitHub: <span class="blue mono">jeremyevans</span>
</h1><h1 class="red" style="font-size: 48px; position: absolute; top: 328px; left: 500px;">Twitter: <span class="blue mono">@jeremyevans0</span>
</h1></p>
</div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/3">

<div class="notes">
<p>First, let me go over the agenda for this presentation. I&#x2019;ll talk about the history of Rodauth, highlight some differences between Rodauth and other Ruby authentication frameworks, discuss Rodauth&#x2019;s goals, and get into some code examples so you can get a good idea of how Rodauth is configured and how to use it.</p>
</div>
<h1 class="red" style="font-size: 200px; position: absolute; top: 40px; left: 260px;">Agenda</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/4">

<div class="notes">
<p>First, a brief history of Rodauth. Rodauth was created in 2015. At that time I had over 10 separate applications I maintained that all had ad-hoc approaches to authentication. Authentication requirements differed significantly between the applications. Multiple applications used LDAP for authentication, while others stored password hashes in the database. All of the Ruby authentication frameworks at the time were specific to Rails, and none of my applications were Rails applications. So I got a crazy idea to write my own authentication framework, and it had to be flexible enough to handle the very different requirements of each application. After a review of other authentication frameworks, I also wanted this framework to take a different and stronger approach to password hash storage security, since this more secure approach was already in use in a few of my applications.</p>
</div>
<h1 class="blue" style="font-size: 200px; position: absolute; top: 340px; left: 260px;">History</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/5">

<div class="notes">
<p>Now, about Rodauth&#x2019;s tag line, Ruby&#x2019;s most advanced authentication framework. That&#x2019;s a bold claim, considering there are older and more popular authentication frameworks such as Devise, Authlogic, Sorcery and Clearance. However, hopefully by the end of this presentation, I&#x2019;ll have convinced you that Rodauth is Ruby&#x2019;s most advanced authentication framework. If I do a good job, maybe you&#x2019;ll even want to consider using it in your next project.</p>
</div>
<h1 class="red" style="font-size: 80px; position: absolute; top: 220px; left: 40px;">Ruby's Most Advanced Authentication Framework</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/6">

<div class="notes">
<p>Next, let&#x2019;s talk about features. I&#x2019;ll compare features between Devise and Rodauth. Clearance, Authlogic, and Sorcery have features that are more or less a subset of Devise&#x2019;s features, so this analysis should also apply to them.</p>
</div>
<h1 class="blue" style="font-size: 180px; position: absolute; top: 180px; left: 400px;">Features</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/7">

<div class="notes">
<p>Rodauth handles pretty much all of Devise&#x2019;s features. Rodauth has features for login and logout, creating accounts, verifying email addresses for accounts, handling password resets, locking out accounts after a number of failed attempts, remembering users using a cookie, logging authentication actions, expiring sessions, validating logins and passwords, and allowing users to close their accounts.</p>
</div>
<pre style="font-size: 36px; margin-top: 0;"><code>
Login
Logout
Create Account
Verify Account
Reset Password
Account Lockout
Remember
Audit Logging
Session Expiration
Login/Password Validations
Close Account
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/8">

<div class="notes">
<p>Rodauth doesn&#x2019;t stop there, it handles many other security related features. It supports disabling the reuse of passwords, disabling common passwords, forcing password or account expiration, forcing only a single session, or allowing global logout of all sessions for a user.</p>
</div>
<pre style="font-size: 36px; margin-top: 0;"><code>
Login                         Account Expiration
Logout                        Single Session
Create Account                Global Logout
Verify Account
Reset Password
Account Lockout
Remember
Audit Logging
Session Expiration
Login/Password Validations
Close Account
Disable Password Reuse
Disable Common Passwords
Password Expiration
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/9">

<div class="notes">
<p>Rodauth ships with support for multiple multifactor authentication methods. It supports WebAuthn security keys, as well as TOTP, the time based one time codes. You can also setup multifactor authentication using SMS, or generate account recovery codes in case a user loses access to their normal multifactor authentication device.</p>
</div>
<pre style="font-size: 36px; margin-top: 0;"><code>
Login                         Account Expiration
Logout                        Single Session
Create Account                Global Logout
Verify Account                WebAuthn
Reset Password                TOTP
Account Lockout               SMS Codes
Remember                      Recovery Codes
Audit Logging
Session Expiration
Login/Password Validations
Close Account
Disable Password Reuse
Disable Common Passwords
Password Expiration
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/10">

<div class="notes">
<p>Rodauth ships with support for multiple passwordless authentication methods, allowing for authentication using email links, or using a WebAuthn security key instead of a password to login.</p>
</div>
<pre style="font-size: 36px; margin-top: 0;"><code>
Login                         Account Expiration
Logout                        Single Session
Create Account                Global Logout
Verify Account                WebAuthn
Reset Password                TOTP
Account Lockout               SMS Codes
Remember                      Recovery Codes
Audit Logging                 Email Authentication
Session Expiration            WebAuthn Login
Login/Password Validations
Close Account
Disable Password Reuse
Disable Common Passwords
Password Expiration
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/11">

<div class="notes">
<p>Rodauth includes a JSON API for all features it ships with, storing authentication information in JSON web tokens. That&#x2019;s right, every feature can be used both with standard HTML forms and also via a JSON API. The JSON API supports cross origin resource sharing, as well as separate access and refresh tokens.</p>
</div>
<pre style="font-size: 36px; margin-top: 0;"><code>
Login                         Account Expiration
Logout                        Single Session
Create Account                Global Logout
Verify Account                WebAuthn
Reset Password                TOTP
Account Lockout               SMS Codes
Remember                      Recovery Codes
Audit Logging                 Email Authentication
Session Expiration            WebAuthn Login
Login/Password Validations    JSON API (JWT)
Close Account                 CORS
Disable Password Reuse        Access/Refresh Tokens
Disable Common Passwords
Password Expiration
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/12">

<div class="notes">
<p>Now, Rodauth has a lot of features, but can&#x2019;t you get the same features using third party extensions to Devise? In some cases, you can. There is a Devise extension to add a JSON API, a Devise extension to add TOTP support, and a Devise extension to add WebAuthn support. However, if you want to support TOTP or WebAuthn support via a JSON API, you&#x2019;ll probably have to write such an extension yourself. The main benefit of having Rodauth include all of these features is that you don&#x2019;t need to worry that a Rodauth upgrade will break one of the features you are using, unlike when using a third-party Devise extension.</p>
</div>
<pre style="font-size: 36px; margin-top: 0;"><code>
Login                         Account Expiration
Logout                        Single Session
Create Account                Global Logout
Verify Account                WebAuthn
Reset Password                TOTP
Account Lockout               SMS Codes
Remember                      Recovery Codes
Audit Logging                 Email Authentication
Session Expiration            WebAuthn Login
Login/Password Validations    JSON API (JWT)
Close Account                 CORS
Disable Password Reuse        Access/Refresh Tokens
Disable Common Passwords
Password Expiration
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/13">

<div class="notes">
<p>Hopefully I&#x2019;ve demonstrated that Rodauth ships with pretty much all authentication features your application could need.</p>
</div>
<h1 class="blue" style="font-size: 180px; position: absolute; top: 320px; left: 340px;">Features</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/14">

<div class="notes">
<p>One thing Rodauth doesn&#x2019;t ship with is support for OAuth. This is because Rodauth is designed for cases where you are handling the authentication, while OAuth is designed for cases where you are letting a third party handle the authentication. Many of Rodauth&#x2019;s features such as changing a password or locking out an account would make no sense when using OAuth. You can certainly use both Rodauth and OAuth in the same application if you want to support both. The authentication flows are separate and the two should not conflict.</p>
</div>
<h1 class="red" style="font-size: 180px; position: absolute; top: 80px; left: 340px;">No</h1><h1 class="blue" style="font-size: 180px; position: absolute; top: 220px; left: 340px;">OAuth</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/15">

<div class="notes">
<p>If you do want to have OAuth support integrated into Rodauth, there is an Rodauth feature that ships in an external gem. It&#x2019;s currently named roda-oauth, but will be switching to rodauth-oauth in the next release.</p>
</div>
<h1 class="blue" style="font-size: 180px; position: absolute; top: 220px; left: 340px;">OAuth</h1><h1 class="red" style="font-size: 120px; position: absolute; top: 380px; left: 255px;">rodauth-oauth</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/16">

<div class="notes">
<p>Next, I&#x2019;m going to talk about security. Rodauth has a stronger security approach than other authentication frameworks, especially in regards to password hash storage.</p>
</div>
<h1 class="blue" style="font-size: 180px; position: absolute; top: 120px; left: 140px;">Security</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/17">

<div class="notes">
<p>The biggest problems with passwords is that people tend to choose poor passwords and tend to reuse the same password on multiple sites. This means that any popular site that stores passwords is a target for hackers. Even if the site stores nothing else of value, if hackers can get access to the stored password hashes, they can try to crack the hashes, and then use the same email address and cracked password to access the other, higher value websites.</p>
</div>
<h1 class="red" style="font-size: 150px; position: absolute; top: 80px; left: 140px;">Password</h1><h1 class="blue" style="font-size: 150px; position: absolute; top: 200px; left: 140px;">Hash</h1><h1 class="red" style="font-size: 150px; position: absolute; top: 320px; left: 140px;">Storage</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/18">

<div class="notes">
<p>Most of the other authentication frameworks I mentioned store the password hash in a column in the user&#x2019;s table. With a single SQL injection vulnerability in the application, the hackers can get access to the password hashes for all users, which then they can try to crack offline using dedicated password cracking machines.</p>
</div>
<h1 class="red" style="font-size: 150px; position: absolute; top: 80px; left: 140px;">Password</h1><h1 class="blue" style="font-size: 150px; position: absolute; top: 200px; left: 140px;">Hash</h1><h1 class="red" style="font-size: 150px; position: absolute; top: 320px; left: 140px;">Column</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/19">

<div class="notes">
<p>Rodauth uses a different approach by default. It stores the password hashes in a separate table and prevents the application from reading from that table. To check for a valid password, Rodauth calls a database function to get the password hash salt for an account. It uses the salt and provided password to compute a password hash. It then calls another database function to check if the computed password hash matches the stored password hash. The database functions have access to read the table, but direct access is not allowed. This uses a technique called security definer database functions. Rodauth uses this approach by default on PostgreSQL, MySQL, and Microsoft SQL Server. However, for compatibility, Rodauth can also function in cases where database functions cannot be used, or when the password hash is stored in a separate column in the same table.</p>
</div>
<h1 class="red" style="font-size: 150px; position: absolute; top: 80px; left: 140px;">Password</h1><h1 class="blue" style="font-size: 150px; position: absolute; top: 200px; left: 140px;">Hash</h1><h1 class="red" style="font-size: 150px; position: absolute; top: 320px; left: 140px;">Table</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/20">

<div class="notes">
<p>Unlike other authentication frameworks that use purely random tokens for things like password resets and account unlocks, Rodauth&#x2019;s tokens always include the account identifier in the token. This prevents the ability to brute force all current tokens for all accounts at the same time. With Rodauth, you can only try to brute force the token for a single account, and the token is compared using a constant-time string comparison. With other authentication frameworks, the token is looked up using a database index, allowing for a theoretical timing attack.</p>
</div>
<h1 class="blue" style="font-size: 180px; position: absolute; top: 120px; left: 140px;">Tokens</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/21">

<div class="notes">
<p>Rodauth supports and recommends using HMACs for additional security for tokens. This makes it so that even if an attacker is able to exploit an SQL injection vulnerability in the application and get access to all of the tokens, the tokens will not be usable without knowledge of a separate secret, which isn&#x2019;t stored in the database.</p>
</div>
<h1 class="red" style="font-size: 180px; position: absolute; top: 120px; left: 440px;">HMAC</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/22">

<div class="notes">
<p>Rodauth has three goals: security, simplicity, and flexibility. I&#x2019;ve discussed security, so let me move on to simplicity. With most of the other authentication frameworks, configuring them requires changes in multiple separate areas. You&#x2019;ll be configuing a model, a controller, views, and routes, all in separate places.</p>
</div>
<h1 class="blue" style="font-size: 180px; position: absolute; top: 320px; left: 340px;">Simplicity</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/23">

<div class="notes">
<p>Rodauth handles all authentication configuration in the same block.</p>
</div>
<h1 class="red" style="font-size: 150px; position: absolute; top: 120px; left: 40px;">Single</h1><h1 class="blue" style="font-size: 150px; position: absolute; top: 250px; left: 40px;">Configuration</h1><h1 class="red" style="font-size: 150px; position: absolute; top: 380px; left: 40px;">Block</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/24">

<div class="notes">
<p>In your application, when you load Rodauth, you pass a block, and this block is used to configure all of Rodauth&#x2019;s features. Note that all of the features I discussed earlier are optional. With Rodauth, you explicitly enable every feature you want to use.</p>
</div>
<pre class="sh_ruby" style="font-size: 40px; margin-top: 0px;"><code>
  plugin :rodauth do
  end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/25">

<div class="notes">
<p>You enable rodauth features by calling the enable method inside the block. This loads the feature into the Rodauth configuration, including loading methods used to configure the feature.</p>
</div>
<pre class="sh_ruby" style="font-size: 40px; margin-top: 0px;"><code>
  plugin :rodauth do
<b class="block">    enable :login, :logout,
           :create_account, :reset_password</b>  end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/26">

<div class="notes">
<p>Maybe you were using a different table name for the table storing the password reset tokens. Also, maybe you want to change the subject of the password reset email. After loading the reset password feature, you can call methods to override the default values for both settings. Rodauth ships with over 1000 such configuration methods, allowing overriding virtually all parts of every supported feature.</p>
</div>
<pre class="sh_ruby" style="font-size: 40px; margin-top: 0px;"><code>
  plugin :rodauth do
    enable :login, :logout,
           :create_account, :reset_password
<b class="block">    reset_password_table :password_resets
    reset_password_email_subject \
      'You Forgot Your Password!?'</b>  end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/27">

<div class="notes">
<p>Rodauth doesn&#x2019;t stop there. It also allows you to override all parts of every supported feature in a request specific manner. All of Rodauth&#x2019;s configuration methods accept a block. Passing a block allows for request specific behavior. In this example, we assume that the accounts table has a column specifying whether the account is an admin. If the account is an admin account, we use a different email subject that includes the IP address the password reset request was received from, as the admin may find that useful. Let me state again for emphesis, all of Rodauth&#x2019;s configuration methods support this feature, and so all configuration can be request-specific.</p>
</div>
<pre class="sh_ruby" style="font-size: 40px; margin-top: 0px;"><code>
  plugin :rodauth do
    enable :login, :logout,
           :create_account, :reset_password
    reset_password_table :password_resets
<b class="block">    reset_password_email_subject do
      if account[:admin]
        "Password Reset from #{request.ip}"
      else
        'You Forgot Your Password!?'
      end
    end</b>  end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/28">

<div class="notes">
<p>This ability to choose exactly which features to enable and the ability to override any part of the framework in a request specific manner is how Rodauth achieves its third goal of flexibility.</p>
</div>
<h1 class="blue" style="font-size: 180px; position: absolute; top: 320px; left: 340px;">Flexibility</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/29">

<div class="notes">
<p>When I was going through the previous example, you might have noticed that we loaded Rodauth by calling the plugin method. What&#x2019;s going on here?</p>
</div>
<pre class="sh_ruby" style="font-size: 40px; margin-top: 0px;"><code>
  <b>plugin</b> :rodauth do
    enable :login, :logout,
      :create_account, :reset_password
  end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/30">

<div class="notes">
<p>This is because Rodauth is implemented as a plugin for the Roda web toolkit. So far, I&#x2019;ve only shown how Rodauth is configured, not how to use that. Let&#x2019;s correct now.</p>
</div>
<pre class="sh_ruby" style="font-size: 40px; margin-top: 0px;"><code><b>class App &lt; Roda</b>
  plugin :rodauth do
    enable :login, :logout,
      :create_account, :reset_password
  end
end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/31">

<div class="notes">
<p>Roda is a web toolkit that uses the idea of routing requests using a tree made out of Ruby blocks. You can also think of it as a fast and configurable web framework. When a request is received, this route block is called.</p>
</div>
<pre class="sh_ruby" style="font-size: 40px; margin-top: 0px;"><code>class App &lt; Roda
  plugin :rodauth do
    enable :login, :logout,
      :create_account, :reset_password
  end


<b class="block">  route do |r|
    r.rodauth
    rodauth.require_authentication
    # rest of application
  end</b>end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/32">

<div class="notes">
<p>The route block is yielded the request object, and the first line calls the rodauth method on the request object. This handles all of the routes added by Rodauth.</p>
</div>
<pre class="sh_ruby" style="font-size: 40px; margin-top: 0px;"><code>class App &lt; Roda
  plugin :rodauth do
    enable :login, :logout,
      :create_account, :reset_password
  end


  route do |r|
    <b>r.rodauth</b>
    rodauth.require_authentication
    # rest of application
  end
end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/33">

<div class="notes">
<p>The second line calls the require_authentication method on the rodauth object, which will redirect to the login page if the account is not authenticated. This ensures the entire rest of the application is only reached for sessions that have already been authenticated.</p>
</div>
<pre class="sh_ruby" style="font-size: 40px; margin-top: 0px;"><code>class App &lt; Roda
  plugin :rodauth do
    enable :login, :logout,
      :create_account, :reset_password
  end


  route do |r|
    r.rodauth
    <b>rodauth.require_authentication</b>
    # rest of application
  end
end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/34">

<div class="notes">
<p>While Roda is the fastest Ruby web framework with any significant usage, it&#x2019;s still far less popular than Rails or Sinatra. So having Rodauth only usable in Roda applications would be a shame.</p>
</div>
<pre class="sh_ruby" style="font-size: 40px; margin-top: 0px;"><code>class App &lt; Roda
  plugin :rodauth do
    enable :login, :logout,
      :create_account, :reset_password
  end


  route do |r|
    r.rodauth
    rodauth.require_authentication
    # rest of application
  end
end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/35">

<div class="notes">
<p>Thankfully, Roda includes a middleware plugin, which allows the Roda application to be used as Rack middleware by any other Rack application, including Sinatra or Rails.</p>
</div>
<pre class="sh_ruby" style="font-size: 40px; margin-top: 0px;"><code>class App &lt; Roda
  plugin :rodauth do
    enable :login, :logout,
      :create_account, :reset_password
  end
  <b>plugin :middleware</b>

  route do |r|
    r.rodauth
    rodauth.require_authentication
    # rest of application
  end
end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/36">

<div class="notes">
<p>When using Rodauth as middleware, it&#x2019;s best to set the rodauth instance in the rack environment, so that the application using the Rodauth middleware will have access to the rodauth instance.</p>
</div>
<pre class="sh_ruby" style="font-size: 40px; margin-top: 0px;"><code>class App &lt; Roda
  plugin :rodauth do
    enable :login, :logout,
      :create_account, :reset_password
  end
  plugin :middleware

  route do |r|
    r.rodauth
    rodauth.require_authentication
    <b>env['rodauth'] = rodauth</b>
    # rest of application
  end
end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/37">

<div class="notes">
<p>With Sinatra, the integration is almost as simple as this. For Rails, it used to be substantially more involved.</p>
</div>
<pre class="sh_ruby" style="font-size: 40px; margin-top: 0px;"><code>class App &lt; Roda
  plugin :rodauth do
    enable :login, :logout,
      :create_account, :reset_password
  end
  plugin :middleware

  route do |r|
    r.rodauth
    rodauth.require_authentication
    env['rodauth'] = rodauth
    # rest of application
  end
end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/38">

<div class="notes">
<p>Thankfully, Janko Marohnic, the author of Shrine, recently released rodauth-rails, which integrates Rodauth with Rails. So if you have a Rails application and are considering authentication options, adding Rodauth is now about the same difficulty as adding one of the other authentication frameworks. In my biased opinion, it&#x2019;s probably worth it if you need features that are not provided in other frameworks, or value the additional security or flexibility Rodauth offers.</p>
</div>
<h1 class="blue" style="font-size: 120px; position: absolute; top: 220px; left: 240px;">rodauth-rails</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/39">

<div class="notes">
<p>In the previous example, we required authentication for all actions. What if only some sections of your application require authentication? For example, maybe most of your application is open, but only the admin section needs to be authenticated?</p>
</div>
<h1 class="red" style="font-size: 120px; position: absolute; top: 220px; left: 240px;">Conditional</h1><h1 class="blue" style="font-size: 120px; position: absolute; top: 320px; left: 240px;">Authentication</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/40">

<div class="notes">
<p>This is where Roda&#x2019;s routing tree shines. You can easily easily move that require_authentication call from the top of the main route block to the top of the block used for the admin branch. Requests for other branches of the routing tree will not call the block, and therefore authentication will not be enforced for them.</p>
</div>
<pre class="sh_ruby" style="font-size: 40px; margin-top: 0px;"><code>class App &lt; Roda
  plugin :rodauth do
    enable :login, :logout,
      :create_account, :reset_password
  end
  route do |r|
    r.rodauth
    r.on "admin" do
      <b>rodauth.require_authentication</b>
      # admin branch
    end
    # rest of application
  end
end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/41">

<div class="notes">
<p>How about cases where you are need multiple different types of authentication in the same application. Maybe you are issuing WebAuthn security keys to all admins and want to enforce their use. For users, they have an option of using WebAuthn or TOTP authentication if they choose to, but they are not required to set it up.</p>
</div>
<h1 class="red" style="font-size: 120px; position: absolute; top: 220px; left: 240px;">Multiple</h1><h1 class="blue" style="font-size: 120px; position: absolute; top: 320px; left: 240px;">Configurations</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/42">

<div class="notes">
<p>Let&#x2019;s walk through how to set this up in Rodauth.</p>
</div>
<pre class="sh_ruby" style="font-size: 24px; margin-top: 0px;"><code>class App &lt; Roda
  plugin :rodauth do
    enable :login, :logout, :webauthn, :otp
  end
  plugin :rodauth, name: :admin do
    enable :login, :logout, :webauthn
    prefix "/admin"
    session_key 'admin_id'
  end

  route do |r|
    r.on "admin" do
      r.rodauth(:admin)
      rodauth(:admin).require_authentication
      rodauth(:admin).require_two_factor_setup
      # admin branch
    end

    r.rodauth
    rodauth.require_authentication
    # rest of application
  end
end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/43">

<div class="notes">
<p>Our Rodauth configuration for normal users stays mostly the same, except in this example we are using the webauthn and otp features.</p>
</div>
<pre class="sh_ruby" style="font-size: 24px; margin-top: 0px;"><code>class App &lt; Roda
<b class="block">  plugin :rodauth do
    enable :login, :logout, :webauthn, :otp
  end</b>  plugin :rodauth, name: :admin do
    enable :login, :logout, :webauthn
    prefix "/admin"
    session_key 'admin_id'
  end

  route do |r|
    r.on "admin" do
      r.rodauth(:admin)
      rodauth(:admin).require_authentication
      rodauth(:admin).require_two_factor_setup
      # admin branch
    end

    r.rodauth
    rodauth.require_authentication
    # rest of application
  end
end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/44">

<div class="notes">
<p>Here we have a separate configuration for admins that enables the webauthn feature, but not the otp feature.</p>
</div>
<pre class="sh_ruby" style="font-size: 24px; margin-top: 0px;"><code>class App &lt; Roda
  plugin :rodauth do
    enable :login, :logout, :webauthn, :otp
  end
<b class="block">  plugin :rodauth, name: :admin do
    enable :login, :logout, :webauthn
    prefix "/admin"
    session_key 'admin_id'
  end</b> 
  route do |r|
    r.on "admin" do
      r.rodauth(:admin)
      rodauth(:admin).require_authentication
      rodauth(:admin).require_two_factor_setup
      # admin branch
    end

    r.rodauth
    rodauth.require_authentication
    # rest of application
  end
end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/45">

<div class="notes">
<p>We know this configuration is designed for admins because we have given the name admin.</p>
</div>
<pre class="sh_ruby" style="font-size: 24px; margin-top: 0px;"><code>class App &lt; Roda
  plugin :rodauth do
    enable :login, :logout, :webauthn, :otp
  end
  plugin :rodauth, <b>name: :admin</b> do
    enable :login, :logout, :webauthn
    prefix "/admin"
    session_key 'admin_id'
  end

  route do |r|
    r.on "admin" do
      r.rodauth(:admin)
      rodauth(:admin).require_authentication
      rodauth(:admin).require_two_factor_setup
      # admin branch
    end

    r.rodauth
    rodauth.require_authentication
    # rest of application
  end
end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/46">

<div class="notes">
<p>In our admin configuration, we use the prefix configuration method to tell Rodauth that the routes for the admin configuration will be served under the admin branch. It&#x2019;s important that if we have multiple Rodauth configurations that the Rodauth routes use different prefixes so there are no routing conflicts.</p>
</div>
<pre class="sh_ruby" style="font-size: 24px; margin-top: 0px;"><code>class App &lt; Roda
  plugin :rodauth do
    enable :login, :logout, :webauthn, :otp
  end
  plugin :rodauth, name: :admin do
    enable :login, :logout, :webauthn
    <b>prefix "/admin"</b>
    session_key 'admin_id'
  end

  route do |r|
    r.on "admin" do
      r.rodauth(:admin)
      rodauth(:admin).require_authentication
      rodauth(:admin).require_two_factor_setup
      # admin branch
    end

    r.rodauth
    rodauth.require_authentication
    # rest of application
  end
end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/47">

<div class="notes">
<p>We&#x2019;ll also use a different session key in the admin configuration, so that the session key is different from the default. That way logging in as a regular user will not provide access as an admin.</p>
</div>
<pre class="sh_ruby" style="font-size: 24px; margin-top: 0px;"><code>class App &lt; Roda
  plugin :rodauth do
    enable :login, :logout, :webauthn, :otp
  end
  plugin :rodauth, name: :admin do
    enable :login, :logout, :webauthn
    prefix "/admin"
    <b>session_key 'admin_id'</b>
  end

  route do |r|
    r.on "admin" do
      r.rodauth(:admin)
      rodauth(:admin).require_authentication
      rodauth(:admin).require_two_factor_setup
      # admin branch
    end

    r.rodauth
    rodauth.require_authentication
    # rest of application
  end
end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/48">

<div class="notes">
<p>In the admin branch of the routing tree, we first try the Rodauth routes for the admin configuration. We then require authentication for the routes. As we have loaded a multifactor authentication feature, when require authentication is called, it actually does two checks. If the user is not logged in, it redirects them to the login page. If the user has logged in via password but has not authenticated with a second factor, it redirects them to the multifactor authentication page. So if you use require_authentication, you can be sure that you are enforcing multifactor authentication if the user has enabled it.</p>
</div>
<pre class="sh_ruby" style="font-size: 24px; margin-top: 0px;"><code>class App &lt; Roda
  plugin :rodauth do
    enable :login, :logout, :webauthn, :otp
  end
  plugin :rodauth, name: :admin do
    enable :login, :logout, :webauthn
    prefix "/admin"
    session_key 'admin_id'
  end

  route do |r|
    r.on "admin" do
<b class="block">      r.rodauth(:admin)
      rodauth(:admin).require_authentication</b>      rodauth(:admin).require_two_factor_setup
      # admin branch
    end

    r.rodauth
    rodauth.require_authentication
    # rest of application
  end
end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/49">

<div class="notes">
<p>Right after that, we call require_two_factor_setup. If the user has not setup multifactor authentication, this will redirect to the page to setup their WebAuthn security key, and they will not be able to access the admin section until they have done so.</p>
</div>
<pre class="sh_ruby" style="font-size: 24px; margin-top: 0px;"><code>class App &lt; Roda
  plugin :rodauth do
    enable :login, :logout, :webauthn, :otp
  end
  plugin :rodauth, name: :admin do
    enable :login, :logout, :webauthn
    prefix "/admin"
    session_key 'admin_id'
  end

  route do |r|
    r.on "admin" do
      r.rodauth(:admin)
      rodauth(:admin).require_authentication
      <b>rodauth(:admin).require_two_factor_setup</b>
      # admin branch
    end

    r.rodauth
    rodauth.require_authentication
    # rest of application
  end
end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/50">

<div class="notes">
<p>For all other sections of the app other than the admin section, we have the same code I showed previously, which will redirect the user to the login page if they haven&#x2019;t logged in. If they have setup multifactor authentication but not yet authenticated using a second factor, this will redirect them to the multifactor authentication page, just as it did for admins. However, unlike for admins, we are not forcing users to setup multifactor authentication.</p>
</div>
<pre class="sh_ruby" style="font-size: 24px; margin-top: 0px;"><code>class App &lt; Roda
  plugin :rodauth do
    enable :login, :logout, :webauthn, :otp
  end
  plugin :rodauth, name: :admin do
    enable :login, :logout, :webauthn
    prefix "/admin"
    session_key 'admin_id'
  end

  route do |r|
    r.on "admin" do
      r.rodauth(:admin)
      rodauth(:admin).require_authentication
      rodauth(:admin).require_two_factor_setup
      # admin branch
    end

<b class="block">    r.rodauth
    rodauth.require_authentication</b>    # rest of application
  end
end
</code></pre></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/51">

<div class="notes">
<p>I hope I have convinced all of you that Rodauth is Ruby&#x2019;s most advanced authentication framework. It&#x2019;s even better if you will now consider using Rodauth for the authentication needs in your next application.</p>
</div>
<h1 class="blue" style="font-size: 180px; position: absolute; top: 320px; left: 340px;">Takeaway</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/52">

<div class="notes">
<p>If you want to play around with Rodauth, try the demo-site, graciously hosted by Heroku. It&#x2019;s not much to look at, but will give you a good idea for how Rodauth works from the user&#x2019;s perspective.</p>
</div>
<h1 class="red" style="font-size: 72px; position: absolute; top: 250px; left: 40px;">
<span class="blue">rodauth-demo</span>.jeremyevans.net</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/53">

<div class="notes">
<p>If you&#x2019;d like to learn more about Rodauth, visit the Rodauth website, which includes all of Rodauth&#x2019;s documentation, including documentation of every configuration method supported by Rodauth.</p>
</div>
<h1 class="red" style="font-size: 72px; position: absolute; top: 250px; left: 40px;">
<span class="blue">rodauth</span>.jeremyevans.net</h1></div>
</div><div id="slides/slides" class="slide " data-transition="none"><div class="content " ref="slides/slides/54">

<div class="notes">
<p>If you would like to get involved with Rodauth, you can view the source on GitHub, and submit issue reports for any bugs you find, or pull requests to fix bugs or add new features.</p>
</div>
<h1 class="red" style="font-size: 72px; position: absolute; top: 250px; left: 40px;">github.com/jeremyevans/<span class="blue">rodauth</span>
</h1></div>
</div><div id="slides/slides" class="slide bg-thankyou" data-transition="none"><div class="content bg-thankyou" ref="slides/slides/55">

<div class="notes">
<p>That concludes my presentation. I would like to thank all of you for listening to me.</p>
</div>
</div>
</div><div id="slides/slides" class="slide bg-questions" data-transition="none"><div class="content bg-questions" ref="slides/slides/56">

<div class="notes">
<p>If you have any questions, please ask them now.</p>
</div>
</div>
</div>
</div>

</body>
</html>
